
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>History system using React Redux</title>
    <link rel="shortcut icon" href="/assets/icon-512.png"/>
    <link
      rel="stylesheet"
      href="https://unpkg.com/prismjs@1.20.0/themes/prism-tomorrow.css"
    />
    <link rel="stylesheet" href="/assets/baseLayout.css" />
  </head>
  <body>
    <header class="baseLayout-headerOuter">
      <div class="ui-container baseLayout-headerInner">
        <a
          class="baseLayout-headerLink"
          href="/en/"
          tabindex="-1"
        >
          <span class="baseLayout-siteTitle">books.ginpei.dev</span>
        </a>
        <a
          class="baseLayout-headerLink"
          href="https://github.com/ginpei/books.ginpei.dev"
          tabindex="-1"
        >
          GitHub
        </a>
      </div>
    </header>
    <article class="ui-container baseLayout-body">
      <div class="baseLayout-titleGroup">
        <h1 class="baseLayout-title">History system using React Redux</h1>
        <div class="baseLayout-metaLine">
          <a
            href="https://github.com/ginpei/books.ginpei.dev/commits/main/./books/en/history-system-using-react-redux/index.md"
            tabindex="-1"
          >
            
              <time>2023-08-06</time>
              (History)
            
          </a>
        </div>
      </div>
      
      <aside class="baseLayout-toc">
        <nav class="toc" >
        <ol><li><a href="#add-redux-to-your-page">Add Redux to your page</a></li><li><a href="#set-up-undo%2Fredo">Set up undo/redo</a></li><li><a href="#make-a-history-list">Make a history list</a></li><li><a href="#title-histories">Title histories</a></li><li><a href="#separate-from-the-others">Separate from the others</a></li></ol>
      </nav>
      </aside>
      
      <p>Start from here.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> NextPage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"next"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> <span class="token function-variable function">NextPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">History system - Single file example</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home<span class="token punctuation">;</span></code></pre>
<p>And the result code: <a href="https://gist.github.com/ginpei/4a6842db2efd5159e1accf2bbe121121">https://gist.github.com/ginpei/4a6842db2efd5159e1accf2bbe121121</a></p>
<h2 id="add-redux-to-your-page" tabindex="-1"><a class="header-anchor" href="#add-redux-to-your-page"><span>Add Redux to your page</span></a></h2>
<p>Hints:</p>
<ul>
<li>Separate a state you want to enable undo/redo from other states into a sub-state.</li>
</ul>
<p>Install Redux packages.</p>
<pre><code>$ npm install @reduxjs/toolkit react-redux
</code></pre>
<p>Prepare a sub-state. This portion will have own undo/redo history.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// partial state for a section (an undo target)</span>
<span class="token keyword">interface</span> <span class="token class-name">NumberState</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> initialNumberState<span class="token operator">:</span> NumberState <span class="token operator">=</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// methods to update the state</span>
<span class="token comment">// (They are NOT invoked directly)</span>
<span class="token keyword">const</span> numberReducers <span class="token operator">=</span> <span class="token punctuation">{</span>
  set<span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> NumberState<span class="token punctuation">,</span> action<span class="token operator">:</span> PayloadAction<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> NumberState <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>state<span class="token punctuation">,</span>
      value<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// combine above into an object called "slice"</span>
<span class="token keyword">const</span> numberSlice <span class="token operator">=</span> <span class="token function">createSlice</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">"number"</span><span class="token punctuation">,</span>
  initialState<span class="token operator">:</span> initialNumberState<span class="token punctuation">,</span>
  reducers<span class="token operator">:</span> numberReducers<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// kind of getters</span>
<span class="token keyword">function</span> <span class="token function">useNumberValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> StoreState<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// kind of setters generated from reducers to update the state</span>
<span class="token comment">// e.g. dispatch(numberActions.set(10));</span>
<span class="token keyword">const</span> numberActions <span class="token operator">=</span> numberSlice<span class="token punctuation">.</span>actions<span class="token punctuation">;</span></code></pre>
<p>Create a store for a page.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// whole state for a page</span>
<span class="token comment">// (Why separated to sub-states? See below sections)</span>
<span class="token keyword">interface</span> <span class="token class-name">StoreState</span> <span class="token punctuation">{</span>
  <span class="token builtin">number</span><span class="token operator">:</span> NumberState<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// finally, create a store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token generic-function"><span class="token function">configureStore</span><span class="token generic class-name"><span class="token operator">&lt;</span>StoreState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  reducer<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token builtin">number</span><span class="token operator">:</span> numberSlice<span class="token punctuation">.</span>reducer<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Use the store in a page.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// components that use the state have to be wrapped by Provider</span>
<span class="token keyword">const</span> Home<span class="token operator">:</span> <span class="token function-variable function">NextPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// const value = useNumberValue();</span>
  <span class="token comment">// ^ this does not work</span>
  <span class="token comment">//   Error: could not find react-redux context value; please ensure the component is wrapped in a &lt;Provider></span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">PageContent</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// to get, use selectors. e.g. `useNumberValue()` (prepared above)</span>
<span class="token comment">// to update, use dispatch. e.g. `dispatch(numberActions.set())`</span>
<span class="token keyword">function</span> <span class="token function">PageContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useNumberValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">History system - Single file example</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        Value: </span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">" "</span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span>numberActions<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          +10
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h2 id="set-up-undo%2Fredo" tabindex="-1"><a class="header-anchor" href="#set-up-undo%2Fredo"><span>Set up undo/redo</span></a></h2>
<p>Hints:</p>
<ul>
<li>Wrap the sub-state reducer by <code>undoable()</code>.</li>
<li>Wrap the sub-state interface by <code>StateWithHistory</code>.</li>
<li>Update <code>state.subState.value</code> to <code>state.subState.present.value</code>.</li>
<li>To undo, run <code>dispatch(ActionCreators.undo())</code>. To redo, as well.</li>
</ul>
<p>Use <a href="https://www.npmjs.com/package/redux-undo">redux-undo</a>.</p>
<pre><code>$ npm install redux-undo
</code></pre>
<p>Wrap the sub-state reducer by <code>undoable()</code>. Don't forget to update the store state interface because the sub-state is wrapped by <code>StateWithHistory</code> by the <code>undoable()</code>.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> undoable <span class="token keyword">from</span> <span class="token string">"redux-undo"</span><span class="token punctuation">;</span></code></pre>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// whole state for a page</span>
<span class="token comment">// (The sub-state will be wrapped by `undoable()`)</span>
<span class="token keyword">interface</span> <span class="token class-name">StoreState</span> <span class="token punctuation">{</span>
  <span class="token builtin">number</span><span class="token operator">:</span> StateWithHistory<span class="token operator">&lt;</span>NumberState<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// finally, create a store wrapping the sub-state</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token generic-function"><span class="token function">configureStore</span><span class="token generic class-name"><span class="token operator">&lt;</span>StoreState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  reducer<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token builtin">number</span><span class="token operator">:</span> <span class="token function">undoable</span><span class="token punctuation">(</span>numberSlice<span class="token punctuation">.</span>reducer<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Update the selector to follow the above changes.</p>
<p>By the <code>undoable()</code>, the sub-state now has <code>past</code> and <code>future</code> along with <code>present</code>.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token function">useNumberValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> StoreState<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">.</span>present<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Now it's ready to undo/redo. To invoke, use action creators provided by <code>redux-undo</code>.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> ActionCreators <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"redux-undo"</span><span class="token punctuation">;</span></code></pre>
<pre class="language-tsx"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span>ActionCreators<span class="token punctuation">.</span><span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Undo</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span>ActionCreators<span class="token punctuation">.</span><span class="token function">redo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Redo</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>You can disable those buttons by seeing if histories are empty.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token function">useNumberPast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> StoreState<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">.</span>past<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">useNumberFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> StoreState<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">.</span>future<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> past <span class="token operator">=</span> <span class="token function">useNumberPast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> future <span class="token operator">=</span> <span class="token function">useNumberFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class="language-tsx"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
  <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>past<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span>ActionCreators<span class="token punctuation">.</span><span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="token punctuation">></span></span><span class="token plain-text">
  Undo
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></code></pre>
<h2 id="make-a-history-list" tabindex="-1"><a class="header-anchor" href="#make-a-history-list"><span>Make a history list</span></a></h2>
<p>You can show the history of past, present, and future.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token function">useNumberPast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> NumberState<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> StoreState<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">.</span>past<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">useNumberPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> NumberState <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> StoreState<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">.</span>present<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">useNumberFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> NumberState<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span>state<span class="token operator">:</span> StoreState<span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">.</span>future<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> past <span class="token operator">=</span> <span class="token function">useNumberPast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> present <span class="token operator">=</span> <span class="token function">useNumberPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> future <span class="token operator">=</span> <span class="token function">useNumberFuture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class="language-tsx"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span>past<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>v<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>present<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span>future<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>v<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></code></pre>
<p>Use <code>dispatch(ActionCreators.jumpToPast(index))</code> to jump as well as future.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token punctuation">{</span>past<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>v<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span>ActionCreators<span class="token punctuation">.</span><span class="token function">jumpToPast</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span>v<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre>
<h2 id="title-histories" tabindex="-1"><a class="header-anchor" href="#title-histories"><span>Title histories</span></a></h2>
<p>To make it look better, and also give <code>key</code> to each item, update state interface.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// partial state for a section (undo target)</span>
<span class="token keyword">interface</span> <span class="token class-name">NumberState</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> initialNumberState<span class="token operator">:</span> NumberState <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">"initial"</span><span class="token punctuation">,</span>
  value<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  title<span class="token operator">:</span> <span class="token string">"Initial"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>And give the <code>id</code> and <code>title</code> too when you update the state.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// methods to update the state</span>
<span class="token comment">// (They are NOT invoked directly)</span>
<span class="token keyword">const</span> numberReducers <span class="token operator">=</span> <span class="token punctuation">{</span>
  set<span class="token operator">:</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> NumberState<span class="token punctuation">,</span> action<span class="token operator">:</span> PayloadAction<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">:</span> NumberState <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>state<span class="token punctuation">,</span>
      id<span class="token operator">:</span> crypto<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      value<span class="token punctuation">,</span>
      title<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Set </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Now you can use them.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span>past<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>v<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>v<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>present<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span>future<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>v<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>v<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></code></pre>
<h2 id="separate-from-the-others" tabindex="-1"><a class="header-anchor" href="#separate-from-the-others"><span>Separate from the others</span></a></h2>
<p>A history is still shared between whole store state. You can separate it by giving a specific name to the <code>undoable()</code>.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> numberStateUndoableOption<span class="token operator">:</span> UndoableOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  undoType<span class="token operator">:</span> <span class="token string">"NUMBER_UNDO"</span><span class="token punctuation">,</span>
  redoType<span class="token operator">:</span> <span class="token string">"NUMBER_REDO"</span><span class="token punctuation">,</span>
  jumpToPastType<span class="token operator">:</span> <span class="token string">"NUMBER_JUMP_TO_PAST"</span><span class="token punctuation">,</span>
  jumpToFutureType<span class="token operator">:</span> <span class="token string">"NUMBER_JUMP_TO_FUTURE"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// finally, create a store wrapping the sub state</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token generic-function"><span class="token function">configureStore</span><span class="token generic class-name"><span class="token operator">&lt;</span>StoreState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  reducer<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token builtin">number</span><span class="token operator">:</span> <span class="token function">undoable</span><span class="token punctuation">(</span>numberSlice<span class="token punctuation">.</span>reducer<span class="token punctuation">,</span> numberStateUndoableOption<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Prepare action creators with the names in the options.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> numberHistoryActions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">undo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> numberStateUndoableOption<span class="token punctuation">.</span>undoType <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">redo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> numberStateUndoableOption<span class="token punctuation">.</span>redoType <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">jumpToPast</span><span class="token operator">:</span> <span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> numberStateUndoableOption<span class="token punctuation">.</span>jumpToPastType<span class="token punctuation">,</span>
    index<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">jumpToFuture</span><span class="token operator">:</span> <span class="token punctuation">(</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> numberStateUndoableOption<span class="token punctuation">.</span>jumpToFutureType<span class="token punctuation">,</span>
    index<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>And replace the existing ones, like <code>ActionCreators.undo()</code> with <code>numberHistoryActions.undo()</code>.</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
  <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>past<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span>numberHistoryActions<span class="token punctuation">.</span><span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>
<span class="token punctuation">></span></span><span class="token plain-text">
  Undo
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></code></pre>
<pre class="language-tsx"><code class="language-tsx"><span class="token punctuation">{</span>past<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>v<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span>numberHistoryActions<span class="token punctuation">.</span><span class="token function">jumpToPast</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span>v<span class="token punctuation">.</span>title<span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre>
<p>As a result, you'll see code like this: <a href="https://gist.github.com/ginpei/4a6842db2efd5159e1accf2bbe121121">https://gist.github.com/ginpei/4a6842db2efd5159e1accf2bbe121121</a></p>

    </article>
    <footer class="baseLayout-footer">
      <div class="ui-container">
        <p><a href="/en/">Home</a></p>
      </div>
    </footer>
  </body>
</html>
