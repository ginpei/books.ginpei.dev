
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Drag elements by JavaScript</title>
    <link rel="shortcut icon" href="/assets/icon-512.png"/>
    <link
      rel="stylesheet"
      href="https://unpkg.com/prismjs@1.20.0/themes/prism-tomorrow.css"
    />
    <link rel="stylesheet" href="/assets/baseLayout.css" />
  </head>
  <body>
    <header class="baseLayout-headerOuter">
      <div class="ui-container baseLayout-headerInner">
        <a
          class="baseLayout-headerLink"
          href="/en/"
          tabindex="-1"
        >
          <span class="baseLayout-siteTitle">books.ginpei.dev</span>
        </a>
        <a
          class="baseLayout-headerLink"
          href="https://github.com/ginpei/books.ginpei.dev"
          tabindex="-1"
        >
          GitHub
        </a>
      </div>
    </header>
    <article class="ui-container baseLayout-body">
      <div class="baseLayout-titleGroup">
        <h1 class="baseLayout-title">Drag elements by JavaScript</h1>
        <div class="baseLayout-metaLine">
          <a
            href="https://github.com/ginpei/books.ginpei.dev/commits/main/./books/en/js-drag/index.md"
            tabindex="-1"
          >
            
              <time>2023-04-11</time>
              (History)
            
          </a>
        </div>
      </div>
      
      <aside class="baseLayout-toc">
        
      </aside>
      
      <ul>
<li><a href="./demo/">Demo</a></li>
</ul>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> elTargets <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.box'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> el <span class="token keyword">of</span> elTargets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pointerdown'</span><span class="token punctuation">,</span> onPointerDown<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * @param {PointerEvent} event
 */</span>
<span class="token keyword">function</span> <span class="token function">onPointerDown</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>currentTarget <span class="token keyword">instanceof</span> <span class="token class-name">HTMLElement</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'No current target'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> el <span class="token operator">=</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">;</span>

  <span class="token keyword">const</span> offsetX <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> el<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">;</span>
  <span class="token keyword">const</span> offsetY <span class="token operator">=</span> event<span class="token punctuation">.</span>clientY <span class="token operator">-</span> el<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span>

  el<span class="token punctuation">.</span><span class="token function">setPointerCapture</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>pointerId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pointermove'</span><span class="token punctuation">,</span> _onPointerMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
  el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pointerup'</span><span class="token punctuation">,</span> _onPointerUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pointercancel'</span><span class="token punctuation">,</span> _onPointerUp<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * @param {PointerEvent} event
   */</span>
  <span class="token keyword">function</span> <span class="token function">_onPointerMove</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span> <span class="token operator">=</span> event<span class="token punctuation">;</span>
    el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>clientX <span class="token operator">-</span> offsetX<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>clientY <span class="token operator">-</span> offsetY<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * @param {PointerEvent} event
   */</span>
  <span class="token keyword">function</span> <span class="token function">_onPointerUp</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span><span class="token function">releasePointerCapture</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>pointerId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'pointermove'</span><span class="token punctuation">,</span> _onPointerMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'pointerup'</span><span class="token punctuation">,</span> _onPointerUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'pointercancel'</span><span class="token punctuation">,</span> _onPointerUp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>

    </article>
    <footer class="baseLayout-footer">
      <div class="ui-container">
        <p><a href="/en/">Home</a></p>
      </div>
    </footer>
  </body>
</html>
